<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Live News Channel</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+Devanagari:wght@700&display=swap');
        
        body { margin: 0; background: #000; overflow: hidden; font-family: 'Noto Sans Devanagari', sans-serif; }
        
        /* 1. ‡§á‡§Æ‡•á‡§ú ‡§è‡§∞‡§ø‡§Ø‡§æ */
        #tv-screen {
            width: 100vw; height: 85vh;
            background: #000; display: flex; justify-content: center; align-items: center;
        }
        #news-img {
            max-width: 100%; max-height: 100%;
            border: 2px solid #333;
            box-shadow: 0 0 50px rgba(255,0,0,0.2);
        }

        /* 2. ‡§¨‡•ç‡§∞‡•á‡§ï‡§ø‡§Ç‡§ó ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§™‡§ü‡•ç‡§ü‡•Ä (‡§®‡•Ä‡§ö‡•á) */
        .ticker-wrap {
            position: fixed; bottom: 0; width: 100%; height: 15vh;
            background: linear-gradient(90deg, #cc0000 0%, #990000 100%);
            display: flex; align-items: center; padding-left: 20px;
            color: white; border-top: 5px solid #ffcc00;
            box-shadow: 0 -10px 20px rgba(0,0,0,0.5);
        }

        .label {
            background: #ffcc00; color: #cc0000;
            padding: 5px 15px; font-size: 2vw; font-weight: 900;
            border-radius: 5px; margin-right: 20px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.3);
            animation: blink 1s infinite;
        }

        #headline {
            font-size: 3vw; font-weight: 700;
            text-shadow: 2px 2px 4px #000;
            width: 80%;
        }

        /* 3. ‡§∏‡•ç‡§ü‡§æ‡§∞‡•ç‡§ü ‡§¨‡§ü‡§® */
        #overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 100;
            display: flex; justify-content: center; align-items: center;
            color: white; font-size: 30px; cursor: pointer;
        }
        
        @keyframes blink { 50% { opacity: 0.5; } }
    </style>
</head>
<body>

    <div id="overlay" onclick="startChannel()">
        CLICK TO START NEWS
    </div>

    <div id="tv-screen">
        <img id="news-img" src="https://via.placeholder.com/1280x720/000000/FFFFFF/?text=Loading..." alt="News">
    </div>

    <div class="ticker-wrap">
        <div class="label">BREAKING</div>
        <div id="headline">‡§ï‡§®‡•á‡§ï‡•ç‡§ü‡§ø‡§Ç‡§ó...</div>
    </div>

    <script>
        // üëá ‡§Ö‡§™‡§®‡•Ä ‡§∂‡•Ä‡§ü ‡§ï‡§æ CSV ‡§≤‡§ø‡§Ç‡§ï ‡§Ø‡§π‡§æ‡§Å ‡§™‡•á‡§∏‡•ç‡§ü ‡§ï‡§∞‡•á‡§Ç (Step 1 ‡§µ‡§æ‡§≤‡§æ)
        const CSV_LINK = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQZYo2L58_aXsBjXeYAsrmbnWGiz7JBOQKiordJEwS6H6dNaNUDGjLUkjBTQuiws55WJvYcAZ5LdxAx/pub?gid=0&single=true&output=csv'; 

        let newsData = [];
        let index = 0;

        // 1. ‡§∂‡•Ä‡§ü ‡§∏‡•á ‡§°‡•á‡§ü‡§æ ‡§ñ‡•Ä‡§Ç‡§ö‡§®‡§æ
        async function loadNews() {
            try {
                // cache-busting ‡§ï‡•á ‡§≤‡§ø‡§è time parameter ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ
                const res = await fetch(CSV_LINK + '&t=' + Date.now());
                const text = await res.text();
                const rows = text.split('\n').slice(1); // ‡§π‡•á‡§°‡§∞ ‡§π‡§ü‡§æ‡§è‡§Ç
                
                newsData = rows.map(r => {
                    // CSV ‡§ï‡•ã ‡§∏‡§π‡•Ä ‡§∏‡•á ‡§§‡•ã‡•ú‡§®‡•á ‡§ï‡§æ ‡§≤‡•â‡§ú‡§ø‡§ï
                    const c = r.split(/,(?=(?:(?:[^"]*"){2})*[^"]*$)/);
                    return { 
                        text: c[0] ? c[0].replace(/"/g, '').trim() : "News",
                        img: c[1] ? c[1].replace(/"/g, '').trim() : ""
                    };
                }).filter(n => n.text.length > 2); // ‡§ñ‡§æ‡§≤‡•Ä ‡§≤‡§æ‡§á‡§® ‡§π‡§ü‡§æ‡§è‡§Ç
                
                return true;
            } catch (e) { console.log("Error:", e); return false; }
        }

        // 2. ‡§è‡§Ç‡§ï‡§∞ ‡§ï‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º (Clean Voice)
        function speak(txt) {
            return new Promise(resolve => {
                window.speechSynthesis.cancel();
                const u = new SpeechSynthesisUtterance(txt);
                u.lang = 'hi-IN'; 
                u.rate = 0.9;
                
                // ‡§π‡§ø‡§Ç‡§¶‡•Ä ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§¢‡•Ç‡§Å‡§¢‡§®‡§æ
                const voices = window.speechSynthesis.getVoices();
                const hiVoice = voices.find(v => v.lang.includes('hi')) || voices[0];
                u.voice = hiVoice;

                u.onend = resolve;
                window.speechSynthesis.speak(u);
            });
        }

        // 3. ‡§á‡§Æ‡•á‡§ú ‡§¨‡§¶‡§≤‡§®‡§æ
        function showImage(url) {
            const img = document.getElementById('news-img');
            if(url && url.startsWith('http')) {
                img.src = url;
            } else {
                // ‡§Ö‡§ó‡§∞ ‡§´‡•ã‡§ü‡•ã ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à ‡§§‡•ã ‡§¨‡•ç‡§≤‡•à‡§ï ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§®
                img.src = "https://via.placeholder.com/1280x720/000000/FFFFFF/?text=PTN+NEWS"; 
            }
        }

        // 4. ‡§®‡•ç‡§Ø‡•Ç‡•õ ‡§≤‡•Ç‡§™ (Main Loop)
        async function runLoop() {
            if(newsData.length === 0) await loadNews();
            
            if(index >= newsData.length) {
                index = 0;
                await loadNews(); // ‡§≤‡•Ç‡§™ ‡§ñ‡§§‡•ç‡§Æ ‡§π‡•ã‡§®‡•á ‡§™‡§∞ ‡§§‡§æ‡§ú‡§º‡§æ ‡§ñ‡§¨‡§∞‡•á‡§Ç ‡§ö‡•á‡§ï ‡§ï‡§∞‡•á‡§Ç
            }

            const item = newsData[index];
            
            // ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ ‡§¶‡§ø‡§ñ‡§æ‡§è‡§Ç
            document.getElementById('headline').innerText = item.text;
            showImage(item.img);

            // ‡§¨‡•ã‡§≤‡•á‡§Ç
            await speak(item.text);

            // ‡§Ö‡§ó‡§≤‡•Ä ‡§ñ‡§¨‡§∞ ‡§∏‡•á ‡§™‡§π‡§≤‡•á 2 ‡§∏‡•á‡§ï‡§Ç‡§° ‡§∞‡•Å‡§ï‡•á‡§Ç
            await new Promise(r => setTimeout(r, 2000));

            index++;
            runLoop();
        }

        function startChannel() {
            document.getElementById('overlay').style.display = 'none';
            // Chrome ‡§ï‡•ã ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§≤‡•ã‡§° ‡§ï‡§∞‡§®‡•á ‡§ï‡§æ ‡§∏‡§Æ‡§Ø ‡§¶‡•á‡§Ç
            window.speechSynthesis.getVoices();
            runLoop();
        }
        
        // ‡§Ü‡§µ‡§æ‡§ú‡§º ‡§≤‡•ã‡§° ‡§π‡•ã‡§®‡•á ‡§ï‡§æ ‡§á‡§Ç‡§§‡§ú‡§º‡§æ‡§∞
        window.speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();

    </script>
</body>
</html>
